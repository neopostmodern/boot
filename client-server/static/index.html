<!doctype html>
<html>
<head>
    <title>CrocoOps</title>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon" type="image/png"
          href="data:image/webp;base64,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"/>
</head>
<body>
<h1>CrocoOps</h1>
<main>
    <div id="actions"></div>
    <div id="log"></div>
</main>
<script>
    (async () => {
        const result = await fetch('/introspection')
        const introspection = await result.json()
        Object.entries(introspection).forEach(([subsystemName, subsystem]) => {
            const section = document.createElement('section')
            section.innerHTML = `<h2>${subsystemName}</h2>
${Object.entries(subsystem).map(([methodName, {arguments: methodArguments, hints}]) => {
                let extraInputs;
                if (hints[0] && hints[0].type === 'servo' && hints[0].min_angle && hints[0].max_angle) {
                    extraInputs = `<input class="slider" name="angle" type="range" min="${hints[0].min_angle}" max="${hints[0].max_angle}" value="${((hints[0].min_angle + hints[0].max_angle) / 2).toFixed(0)}" />`;
                }
                return `<form>
<div>
  ${methodName}
  <button>â†’</button>
</div>
<input type="hidden" name="method" value="${subsystemName}.${methodName}" />
${extraInputs || methodArguments.map(argument => `<input name="${argument.name}" placeholder="${argument.name}" />`).join('\n')}
${hints.map(hint => `<div>${JSON.stringify(hint)}</div>`)}
  </form>`
            }).join('\n')}`
            document.querySelector('#actions').appendChild(section)
        })
    })()

    setTimeout(() => {
        const submitForm = async (form) => {
            const data = new FormData(form)
            let url = '/exec?' + [...data.entries()].map(([key, value]) => `${key}=${value}`).join('&')
            console.log(url)
            const commandResult = await fetch(url)
            const commandLog = await commandResult.text()
            const logElement = document.querySelector('#log')
            const logEntry = document.createElement('pre')
            logEntry.innerText = commandLog
            logElement.appendChild(logEntry)
        }

        [...document.querySelectorAll('form')].forEach(form => {
            form.addEventListener('submit', (event) => {
                event.preventDefault();

                submitForm(form);
            })
        })
        ;[...document.querySelectorAll('.slider')].forEach(slider => {
            slider.addEventListener('input', () => {
                submitForm(slider.parentElement);
            })
        })
    }, 1000)


    ;(async () => {
        const result = await fetch('/constants')
        const constants = await result.json()
        const footer = document.createElement('footer')
        footer.innerText = JSON.stringify(constants, null, 2)
        document.querySelector('#actions').appendChild(footer)
    })()
</script>
</body>
</html>